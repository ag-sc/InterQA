<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"><![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>InterQA Demo</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/stylesheet.css">
  <!--[if IE 8]><script src="js/es5.js"></script><![endif]-->
  <script src="selectize/jquery-2.1.4.min.js"></script>
  <!--<script src="js/jquery.js"></script>-->
  <script src="js/index.js"></script>
  <script src="selectize/selectize.js"></script>
  <link rel="stylesheet" href="selectize/selectize.css">
  <script src="selectize/jquery.caret.js" type="text/javascript"></script>
</head>
<body>
<div id="wrapper">
  <h1>InterQA Demo</h1>
  <div class="demo">
    <div id="selectize-wrapper">

    </div>
     <div id="sparql" style=" font-family: monospace;
          background-color: rgb(240,240,240);">

     </div>

    <script>
      //Create the selectize
      var mySelectize = Selectize.createSelectize(jQuery("#selectize-wrapper"),[]);
      var optionsGlobal = [];      
      
      var get_options_success = function get_options_success(e) {

        if (e.length == 0) {
          // No more options means finished -> Show/Execute the SPARQL query
          var getqueries_url = "/interQAWebApp/ServletInterQA?command=getQueries";
          execute_ajax(getqueries_url,
                  function(e){ //server OK. e contains the result of the server call
                      var msg = "";
                      for (var i in e){
                          msg += e[i] + "\n";
                      }
                      $("#sparql").html("<p>" + msg + "</p>");
                  },
                  function(e){  //Server error
                     console.log("Error at get queries");
                  });
        }
	mySelectize.setSelectizeStates(e);
      }
      var initSelect = function initSelect () {
	$("#sparql").html("");
	mySelectize.setSelectizeStates([]);
	optionsGlobal = mySelectize.getSelectizedItems();
        var getoptions_url = "/interQAWebApp/ServletInterQA?command=getOptions";
        var selected_url = "/interQAWebApp/ServletInterQA?command=selected&selection=";
        for (var i in optionsGlobal) {
          selected_url += '' + optionsGlobal[i];
        }
        execute_ajax(selected_url, function (e) {
          execute_ajax(getoptions_url, get_options_success, function(e){
            console.log("Error at get options (after selected)");
          });
        }, function (e) {
          console.log("Error at selected_url");
        });
      };
      //Manage change event
      mySelectize.onChange(initSelect);
      $(document).ready(function () {
        initSelect();
      });
      var execute_ajax = function execute_ajax(url, func_success, func_fail) {
        var request = $.ajax({
          url: url,
          type: "GET",
          datatype: "jsonp",
          crossDomain: true
        });
        request.success(function( msg ) { // Returned 200
          func_success(msg);
        });
        request.fail(function( jqXHR, textStatus ) { //Returned 500
          func_fail("error 500");
        });
      };
    </script>
  </div>
</div>
</body>
</html>
